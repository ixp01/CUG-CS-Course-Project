# 数据库重置和导入说明

## 问题解决方案总结

### 1. PDF字体重叠问题 ✓ 已修复
- 减小了所有字体大小（标题36，正文18，表格16-14）
- 调整了行高和间距

### 2. 批量导出多个记录 ✓ 已实现
- **单选模式**：选择1条记录 → 导出PDF → 选择文件名保存
- **多选模式**：选择多条记录 → 导出PDF → 选择目录 → 自动生成多个PDF文件（命名：检测报告_1.pdf, 检测报告_2.pdf...）
- 支持 Ctrl+点击 或 Shift+点击 多选记录

### 3. 数据库ID对应问题 ✓ 已解决
**原问题**：
- 设备信息表从ID 11开始
- 检测记录引用设备ID 1-10
- 外键不匹配，数据混乱

**解决方案**：
- 创建了新的完整CSV文件集
- 数据关系：5个厂商 → 10个设备 → 13条检测记录 → 52条结果项 → 13条详细数据

### 4. 详细数据导入 ✓ 已说明
- **CSV导入不包含详细数据**（ao/bo/co数据）
- **程序启动时自动插入**：检查 test_result_details 表为空时，自动插入13条详细数据
- 详细数据与检测记录ID一一对应

## 如何重置数据库并重新导入

### 方法1：运行PowerShell脚本（推荐）
```powershell
cd "d:\myCollege\CS class\SE\ecyj"
.\reset_database.ps1
```
脚本会询问是否删除数据库文件，确认后会删除 ecyj.db

### 方法2：手动操作
1. 关闭应用程序
2. 删除 `ecyj.db` 文件
3. 重新启动应用程序（会自动创建新数据库）

## 导入CSV文件步骤

**重要：必须按以下顺序导入！**

1. **切换到"厂商信息"页面**
   - 点击菜单：文件 → 导入CSV
   - 选择：`test_manufacturers_new.csv`
   - 导入5个厂商

2. **切换到"设备信息"页面**
   - 点击菜单：文件 → 导入CSV
   - 选择：`test_equipment_new.csv`
   - 导入10个设备（ID 1-10，外键指向厂商ID 1-5）

3. **切换到"检测记录"页面**
   - 点击菜单：文件 → 导入CSV
   - 选择：`test_records_new.csv`
   - 导入13条检测记录（外键指向设备ID 1-10）

4. **切换到"检测结果项"页面**
   - 点击菜单：文件 → 导入CSV
   - 选择：`test_result_items_new.csv`
   - 导入52条结果项（外键指向检测记录ID 1-13）

5. **详细数据自动插入**
   - 无需手动操作
   - 程序启动时已经自动检查并插入了13条详细数据

## 验证数据完整性

1. **检查厂商**：应该有5条记录
2. **检查设备**：应该有10条记录（产品编号 ECYJ-2024-001 到 ECYJ-2024-010）
3. **检查检测记录**：应该有13条记录
4. **检查检测结果项**：应该有52条记录（13×4=52）
5. **检查详细数据**：
   - 切换到"检测记录"页面
   - 选择任意一条记录
   - 点击"查看详细数据"按钮
   - 应该能看到 ao/bo/co 的完整测量数据

## 批量导出PDF测试

1. 切换到"检测记录"页面
2. 按住 Ctrl 键，点击多条记录（或按住 Shift 选择连续的多条）
3. 点击菜单：文件 → 导出PDF
4. 选择保存目录
5. 系统会自动生成多个PDF文件

## 文件清单

### CSV数据文件（新版）
- `test_manufacturers_new.csv` - 5个厂商
- `test_equipment_new.csv` - 10个设备
- `test_records_new.csv` - 13条检测记录
- `test_result_items_new.csv` - 52条检测结果项

### 脚本文件
- `reset_database.ps1` - 数据库重置脚本
- `reset_and_import.sql` - SQL清理脚本

### 说明文档
- `README_数据导入说明.md` - 本文档

## 常见问题

**Q: 为什么导入CSV时报错"外键约束失败"？**
A: 导入顺序错误。必须先导入厂商，再导入设备，再导入检测记录，最后导入结果项。

**Q: 详细数据在哪里导入？**
A: 详细数据不需要手动导入，程序启动时会自动检查并插入。

**Q: 如何完全重置数据库？**
A: 删除 ecyj.db 文件，重新运行程序即可。

**Q: 能否一次导出所有记录的PDF？**
A: 可以。在检测记录页面按 Ctrl+A 全选，然后导出PDF，选择目标目录即可。

**Q: PDF报告文字还是重叠怎么办？**
A: 已经大幅减小字体，如果仍有问题，可能需要进一步调整 reportgenerator.cpp 中的字体大小参数。
