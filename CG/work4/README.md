计算机图形学实验报告：太阳系三维动画模拟系统

实验名称：真实感图形绘制与三维动画模拟
实验平台：Windows/Linux, OpenGL/GLUT
日期：2025年11月

一、实验目的

掌握核心渲染技术：深入理解并实践计算机图形学中的真实感绘制技术，包括深度测试（消隐）、光照模型、材质设置和颜色混合（半透明处理）。

熟悉曲线建模方法：掌握 Bezier 曲线的原理及其在 OpenGL 中的实现方法（求值器），并应用于复杂非线性轨迹的建模。

实现三维动画：通过矩阵变换和定时器机制实现天体的自转、公转等周期性运动，构建一个可交互、动态的太阳系模型。

培养综合应用能力：将多种图形学技术综合应用于一个复杂的 3D 场景中，提升场景建模和交互设计的实践能力。

二、实验原理

本实验的核心在于综合应用多种经典图形学算法，以实现高度逼真的三维场景。

1. 深度测试（Depth Testing / 消隐）

原理：在三维场景中，物体投影到二维屏幕上时，必须解决不同物体之间的遮挡关系。深度测试（Z-Buffer）通过存储每个像素点的深度值（Z值）来判断哪些表面是可见的。
实现：

在 initOpenGL() 中启用：glEnable(GL_DEPTH_TEST)。

设置深度比较函数为小于等于：glDepthFunc(GL_LEQUAL)。

在 display() 中每帧清空深度缓冲区：glClear(GL_DEPTH_BUFFER_BIT)。

2. 光照与材质（Lighting and Material）

原理：采用局部光照模型（如 Phong 模型），将物体的颜色表现分解为环境光、漫反射光和镜面反射光三部分，模拟光线对物体表面的作用。

光源：太阳被设置为中心点光源 GL_LIGHT0，位置固定在原点 $(0, 0, 0)$。

材质：行星的颜色由 glColor3f 设定，并通过 glEnable(GL_COLOR_MATERIAL) 使颜色作为材质的环境光和漫反射光属性。通过 glMaterialfv 设置镜面反射和光泽度（GL_SHININESS），增强行星表面的光泽感。

光照计算公式的核心在于：

$$I_{total} = I_{ambient} + I_{diffuse} + I_{specular}$$

3. Bezier 曲线

原理：Bezier 曲线是一种参数曲线，由一组控制点定义。给定 $n+1$ 个控制点 $P_0, P_1, \dots, P_n$，其 $n$ 次 Bezier 曲线的参数方程为：

$$B(t) = \sum_{i=0}^{n} P_i B_{i, n}(t), \quad t \in [0, 1]$$

其中 $B_{i, n}(t)$ 是 $n$ 次伯恩斯坦（Bernstein）多项式。
实现：

在 work4.cpp 中定义了 10 个控制点（cometPath）。

使用 OpenGL 的一维求值器 (GL_MAP1_VERTEX_3)：

glMap1f()：设置控制点和参数范围。

glEvalCoord1f(t)：根据参数 $t$ 计算曲线上的点坐标，用于绘制彗星轨道和定位彗星。

4. 颜色混合与半透明处理（Blending and Transparency）

原理：用于实现半透明效果，通过 Alpha 混合将前景物体（如光环、彗尾）的颜色与背景颜色按一定比例混合。混合函数通常遵循以下公式：

$$C_{final} = C_{src} \cdot S_{factor} + C_{dst} \cdot D_{factor}$$

实现：

启用混合功能：glEnable(GL_BLEND)。

设置混合因子：glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)。这意味着最终颜色是源颜色（带透明度的前景物体）乘 Alpha 值，加上目标颜色（背景物体）乘 $(1 - \text{Alpha})$ 值。

应用：在 drawSun() 中绘制半透明光晕；在 drawPlanet() 中绘制土星光环；在 drawComet() 中绘制渐变透明度的彗尾。

5. 几何变换与动画

原理：利用模型视图矩阵实现天体的空间定位和运动。

公转：先对行星进行旋转（角度随时间变化），然后沿 X 轴平移到轨道半径位置。

自转：对已定位的行星再进行一次绕其 Y 轴的旋转。

相机控制：在 display() 函数开头通过 glTranslatef 和 glRotatef 实现对整个场景的平移和旋转，达到控制视角的目的。

动画：通过 glutTimerFunc(16, update, 0) 实现约 60 FPS 的帧率更新，并在 update 函数中实时递增角度参数。

三、实验步骤及源码

1. 环境配置

使用 Visual Studio 2019/2022 作为 IDE，配置 GLUT 库以提供窗口管理和输入回调功能。

2. 初始化设置

调用 initOpenGL() 函数：设置 OpenGL 状态，启用深度测试、光照、混合，并定义光源 GL_LIGHT0 的属性（位置、漫反射、镜面反射等）。

3. 场景建模与动画

绘制天体：使用 glutSolidSphere() 绘制太阳和行星。

实现动画：在 update() 函数中根据时间缩放因子 (timeScale) 更新所有行星的公转角度（angle）和自转角度（rotation），以及彗星的 Bezier 曲线参数 $t$。

渲染：在 display() 函数中按序进行场景绘制、矩阵操作和缓冲区交换。

4. 交互控制

注册 keyboard() 函数，允许用户实时调整视角（W/S/A/D/Q/E）、时间流速（+/-）、以及显示轨道（O）和彗星（C）。

5. 源码

详细源码请参阅文件 work4.cpp。

四、实验结果及分析

1. 动态效果展示

运行程序后，系统成功构建了一个以太阳为中心的实时动态 3D 场景。

天体运动：六大行星以不同的速度和半径绕太阳公转，同时自身进行自转。太阳自身也在慢速自转。

彗星轨迹：彗星沿着预先设定的三维 Bezier 曲线轨道周期性运动，展现了非圆形轨道的建模能力。

真实感渲染：光照效果显著，行星面向太阳的一侧明亮，背光一侧较暗，符合真实物理现象。

半透明特效：土星光环、太阳光晕以及彗星拖尾的半透明效果渲染正确，使得场景视觉效果更加丰富和真实。

2. 技术要点分析

| 技术点 | 效果验证与分析 |
| 深度测试 | 在相机俯视角度，行星遮挡轨道和更远的行星时，遮挡关系正确，证明深度测试功能启用且有效。 |
| 光照模型 | GL_LIGHT0 被设置在原点 $(0,0,0)$，行星的光照面始终朝向太阳，光影过渡平滑（归功于 glShadeModel(GL_SMOOTH)）。 |
| Bezier 曲线 | 彗星的路径明显为一个复杂的封闭曲线，而非简单的圆或椭圆，成功验证了 OpenGL 求值器在复杂轨迹生成中的应用。 |
| 透明处理 | 土星光环和彗尾具有明显的半透明度，且彗尾采用了渐变 Alpha 值，实现了从核到尾的逐渐消散效果（alpha = 0.3f - i * 0.05f），提升了视觉逼真度。 |
| 动画控制 | timeScale 的增减能实时加快或减慢所有天体的运动速度，实现了时间流逝的动态控制。 |

五、实验心得与体会

本次实验是对计算机图形学各项核心技术的一次全面、系统的综合实践。通过亲手实现太阳系模拟，我对以下方面有了更深刻的理解：

几何变换的嵌套与顺序：深入理解了模型视图矩阵操作中，glPushMatrix 和 glPopMatrix 的重要性，以及公转（围绕原点旋转）和平移必须先于自转（围绕自身轴旋转）进行，以确保天体运动逻辑的正确性。

真实感渲染的层级：认识到深度测试是 3D 场景的基础，而光照和材质是提升真实感的关键。通过调整光照参数和材质光泽度，能够显著改变行星的视觉效果。

Alpha 混合的挑战：虽然 glEnable(GL_BLEND) 实现了透明效果，但处理多个透明物体（如太阳光晕、土星光环）时，可能会出现绘制顺序导致的错误。本次实验通过代码设计避免了复杂的深度排序问题，但提示了在更复杂场景中需要进行从后往前的透明物体渲染。

曲线的实用性：Bezier 曲线作为一种强大的曲线拟合工具，在动画路径设计中极具实用价值。掌握 OpenGL 求值器是实现复杂动画轨迹的有效手段。

本次实验不仅成功实现了预期的所有功能和技术点，也为未来进一步学习纹理映射和更高级的实时渲染技术奠定了坚实的实践基础。