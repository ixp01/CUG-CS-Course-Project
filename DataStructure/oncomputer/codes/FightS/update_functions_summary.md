# 航班管理系统 - 更新函数说明

## 主要更新函数

### 1. updateFlightTable()
**作用**: 更新航班管理界面的航班表格
**调用时机**: 
- 添加/删除航班后
- 购票/退票后（更新余票显示）
- 文件数据变化后
- 手动刷新时

**功能**: 
- 清空当前表格
- 重新加载所有航班数据
- 显示航班号、航空公司、出发/到达城市、时间、价格、总座位、余票、状态
- 根据余票数量设置颜色提示（红/黄/绿）

### 2. updateTicketTable(tickets = [])
**作用**: 更新票务操作界面的票务表格
**参数**: 
- tickets: 可选，指定要显示的票务列表，为空则显示所有票务
**调用时机**:
- 购票成功后
- 退票成功后
- 查询票务后
- 手动刷新时

**功能**:
- 显示票号、航班号、乘客姓名、出发/到达城市、购票时间
- 包含空指针检查，防止程序崩溃

### 3. updateFlightComboBox()
**作用**: 更新票务操作界面的航班选择下拉框
**调用时机**:
- 航班数据变化后
- 购票/退票后（更新余票显示）

**功能**:
- 显示格式：航班号 出发城市→到达城市 价格元 (余票:数量)
- 实时显示余票信息

### 4. updateCityComboBoxes()
**作用**: 更新查询界面的出发/到达城市下拉框
**调用时机**:
- 航班数据变化后
- 添加/删除航班后

**功能**:
- 自动提取所有航班的城市信息
- 去重并排序

### 5. updateResultTable(flights)
**作用**: 更新查询界面的查询结果表格
**参数**: 
- flights: 要显示的航班列表
**调用时机**:
- 执行查询后
- 排序操作后

**功能**:
- 显示查询到的航班信息
- 包含余票信息和颜色提示

## 新增刷新按钮功能

### 6. on_refreshFlightButton_clicked()
**作用**: 航班管理界面的手动刷新按钮
**功能**:
- 重新从文件加载航班数据
- 更新航班表格、下拉框、城市列表

### 7. on_refreshTicketButton_clicked()
**作用**: 票务操作界面的手动刷新按钮
**功能**:
- 重新加载所有数据
- 更新票务表格、航班表格、下拉框

### 8. on_refreshSearchButton_clicked()
**作用**: 查询界面的手动刷新按钮
**功能**:
- 重新加载数据
- 更新城市下拉框
- 如果有查询结果，重新执行查询

### 9. refreshAllData()
**作用**: 通用的全数据刷新函数
**功能**:
- 重新加载航班数据
- 更新所有界面元素
- 包含异常处理

## 数据同步机制

### 自动同步
- **文件监控**: 使用QFileSystemWatcher监控数据文件变化
- **延迟刷新**: 500ms延迟避免频繁刷新
- **信号槽机制**: 数据变化时自动触发界面更新

### 手动同步
- **刷新按钮**: 每个标签页都有刷新按钮
- **购票后自动更新**: 购票成功后立即更新所有相关界面
- **退票后自动更新**: 退票成功后恢复余票并更新界面

## 错误处理

### 崩溃预防
- **空指针检查**: 所有涉及指针的操作都有检查
- **异常捕获**: 关键函数包含try-catch块
- **数据验证**: 更新前验证数据有效性

### 用户提示
- **状态栏消息**: 操作结果在状态栏显示
- **错误对话框**: 严重错误弹出对话框提示
- **成功确认**: 重要操作成功后显示确认信息

## 使用建议

1. **购票后**: 系统会自动更新，无需手动刷新
2. **多程序同时使用**: 如果发现数据不同步，点击对应的刷新按钮
3. **程序崩溃**: 重启程序后数据会自动加载最新状态
4. **数据异常**: 使用刷新按钮重新加载数据 